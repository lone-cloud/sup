services:
  server:
    container_name: prism-server
    build:
      context: .
      dockerfile: server/Dockerfile
    ports:
      - '8080:8080'
    environment:
      - PORT=8080
      - API_KEY=${API_KEY:-}
      - VERBOSE_LOGGING=${VERBOSE_LOGGING:-false}
      - ALLOW_INSECURE_HTTP=${ALLOW_INSECURE_HTTP:-false}
      - PROTON_IMAP_USERNAME=${PROTON_IMAP_USERNAME:-}
      - PROTON_IMAP_PASSWORD=${PROTON_IMAP_PASSWORD:-}
      - PROTON_BRIDGE_HOST=protonmail-bridge
      - PROTON_BRIDGE_PORT=${PROTON_BRIDGE_PORT:-143}
      - PROTON_PRISM_TOPIC=${PROTON_PRISM_TOPIC:-Proton Mail}
    volumes:
      - signal-data:/root/.local/share/signal-cli
      - prism-data:/root/.local/share/prism
    restart: unless-stopped

  protonmail-bridge:
    container_name: protonmail-bridge
    image: shenxn/protonmail-bridge:build
    profiles: ['protonmail']
    ports:
      - '127.0.0.1:143:143'
    volumes:
      - proton-bridge-data:/root
      - /tmp/bridge-updates:/root/.local/share/protonmail/bridge-v3/updates:ro
    restart: unless-stopped

volumes:
  signal-data:
  prism-data:
  proton-bridge-data:
